
Latest Angel assignment complete.

Today's project: BeeKeeper (note yesterday's design strategy)


# The Clone Redesign 

Everything is *templated*!
Use Jinja to append different elements of a flask server file together 

Builder will be composed of the following:

- String templates
	- Variables containing templates for different segments of the Flask file
- cloner (function - takes URL, returns URL data structure)
	- Creates a clone of the target webpage  with modified HTML and JS data collector
	- Returns a dictionary containing with entries of the format {ROUTE: html_file_name}
- Builder (function - takes dictionary, returns nothing)
	- Uses the dictionary provided by the builder to create a flask file with a route to each cloned webpage.
	- In the beekeeper file - will also generate/update all the other needed campaign files (JSON, CSV, etc.)
- kill flask sessions
	- Kill the flask sessions if an error occurs or if Ctrl C is pressed. 

### Template elements

- FILE_START 
```python
FILE_START = """
from flask import Flask
app = Flask(__name__)
@app.route("/")
def main_page():
	return render_template({{ file_to_render }})
"""
```
- ROUTE
```python
ROUTE = """
@app.route("{{ route_name }}")
def {{ function name }}():
	return render_template({{ file_to_render }})
"""
```
- FILE_END
```python
FILE_END = """
if __name__ == '__main__':
	app.run(IP={{ IP }}, port={{ port }})
"""
```

### Collector 

Reuse code from original BeeKeeper cloner

1. Takes a URL as input
2. Clones the URL page
3. if recur value is greater than 0, call the cloner function again with the sub url as an argument - return the URL of the page and change the link ref.

```python
def cloner(URL, recur, dictionary):
	print(f"cloning {uri}")
	filename = f"{split_path[3]}_{uri[uri.find(uri.split("/")[len(uri.split("/")) - 1]):]}"
	print(filename)

	try:
		response = requests.get(uri)
	except Exception as err:
		print(err)
		return 0

	#csv ID file update went here

	soup = BeautifulSoup(response.text, 'html.parser')
	links = soup.find_all(['a'])

	# inject JS here

	# recursion
	if recur > 0:
		for link in links:
			dictionary = cloner(URL, recur, dictionary)

	dictionary[URL] = filename
	return dictionary
```

problems:
- Some hrefs are relative - need to figure out how to append the base to it
- Some hrefs direct to subdomains - need to figure out how to link these


# For tomorrow

==figure out how to recognize subdomain links inside the recursive if statement==